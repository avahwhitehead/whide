= Whide - While IDE
Alaric Whitehead <aw548@sussex.ac.uk>, Supervisor: Dr Bernhard Reus <bernhard@sussex.ac.uk>
1.0, 14 November, 2020
:doctype: article
:icons: font

One Paragraph of project description goes here

[#sect:getting-started]
== Getting Started

These instructions will get you a copy of the project up and running on your local machine for development and testing purposes. See deployment for notes on how to deploy the project on a live system.

[#subsect:prerequisites]
=== Prerequisites

What things you need to install the software and how to install them

```
Give examples
```

[#subsect:installing]
=== Installing

A step by step series of examples that tell you how to get a development env running

Say what the step will be

```
Give the example
```

And repeat

```
until finished
```

End with an example of getting some data out of the system or using it for a little demo

[#subsect:testing]
== Running the tests

Explain how to run the automated tests for this system

[#subsect:deployment]
== Deployment

Add additional notes about how to deploy this on a live system

[#subsect:program-information]
== Program Information

=== File Storage

Files are managed using a File Store.
At the moment, the only way to store files is in the browser's Indexed DB.
However, the store is written extensibly so that other stores may be added
(e.g. the local file system when using electron).

While files are in the editor, they are represented by `+FileData+` objects.

To save unnecessary loading, while maintaining extensibility,
file loading/saving is handled by the file store;
`FileData` objects have empty `content`/`metadata` until `fileStore.readFile(fileData)`
is called to load the data into the object.

==== Browser File Storage

File storage in the browser is done using the Indexed DB.

The file structure is stored as an array in a single key in the database (`dirtree`).

Example `+dirtree+`:

[source,json]
----
[
    {
        "id": "2c67370499a716e11f0d4307c0880aed44c0f65e",
        "name": "file1.txt"
    },
    {
        "id":"c37d744560d009ee0104d69ca17f980937146262",
        "name": "file2.txt"
    },
    {
        "id": "",
        "name": "folder",
        "children": [
            {
                "id":"c37d744560d009ee0104d69ca17f980937146262",
                "name": "file2.txt"
            }
        ]
    }
]
----

Each file and folder is assigned an ID;
this is the SHA-1 hash of the time it was created, and it's original name.

    ${createdTimestamp}-${name}

The ID is only used as an internal reference to link files to their content/metadata.
Metadata is stored under the key `+meta:<<id>>+`, and content is under `+content:<<id>>+`

For the key `meta:2c67370499a716e11f0d4307c0880aed44c0f65e`:

[source,json]
----
{
    "created": "<<timestamp>>",
    "...": "..."
}
----

And under `content:2c67370499a716e11f0d4307c0880aed44c0f65e`:

[source]
----
Hello, World!
This is a file.
....
Lorem ipsum dolor sit amet.
----

=== Plugins

The system's plugin architecture is based on a mixture of
https://www.sublimetext.com/docs/3/packages.html[Sublime Text 3],
and https://discord.js.org/#/docs/commando/master/class/Command[Discord.js's Command].

The menu items can be extended

//TODO: Where is the user's config directory
All plugins are stored in the user's config directory.
//TODO: How to store plugins in the browser?
Config files are stored in the `+<<config root>>/whide/+` directory, while code is stored in `+<<config root>>/whide/Plugins+`.

To add a new option to the menu bar, create a new file in the config directory ending in `+.whide-menu+` with contents
similar to this:

.File1
[source, json]
----
[
    {
        "name": "File",
        "children": [
            { "name": "Open", "command": "run_open.js" },
            { "name": "New File", "command": "run_new.js" },
            { "name": "Save", "command": "run_save.js" },
            { "name": "Close", "command": "run_close.js" }
        ]
    },
    {
        "name": "Run",
        "children": [
            { "name": "Run", "command": "run_code.js" },
            { "name": "Debug", "command": "debug.js" }
        ]
    }
]
----

Note that `name` is the name that will be displayed in the menu,
and `command` is the name of the file (relative to `+<<config>>/plugins/+`)

'''

Commands are added using the following file format

[source]
----
function run(args) {
    //When the function is run
}

module.exports = {
    args: [
        //Argument definitions
    ],
    run,
};
----

And triggers can be set up in the config files:

* `+*.whide-menu+` - Triggers through the menu bar
* `+*.whide-keyboard+` - Triggers through keyboard shortcuts
* `+*.whide-mouse+` - Triggers through the mouse right-click menu

[#subsect:buildTools]
== Built With

* http://www.example.com[Item 1] - Lorem Ipsum

[#subsect:license]
== License

This project is licensed under the MIT License - see the LICENSE.md[LICENSE.md] file for details

[#subsect:acknowledgments]
== Acknowledgments

* Hat tip to anyone whose code was used
* Inspiration
* etc